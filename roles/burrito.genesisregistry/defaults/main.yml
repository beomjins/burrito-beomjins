---
genesis_registry:
  root_dir: "/var/lib/registry"
  secret: "{{ lookup('community.general.random_string', length=12, base64=True) }}"
  conf: "/etc/genesis_registry.conf"
  images:
    - "library/registry:{{ registry_version }}"
    - "kube-apiserver:{{ kube_version }}"
    - "kube-controller-manager:{{ kube_version }}"
    - "kube-proxy:{{ kube_version }}"
    - "kube-scheduler:{{ kube_version }}"
    - "cephcsi/cephcsi:{{ cephcsi_version }}"
    - "sig-storage/csi-attacher:{{ csi_attacher_version }}"
    - "sig-storage/csi-node-driver-registrar:{{ csi_node_driver_registrar_version }}"
    - "sig-storage/csi-provisioner:{{ csi_provisioner_version }}"
    - "sig-storage/csi-resizer:{{ csi_resizer_version }}"
    - "sig-storage/csi-snapshotter:{{ csi_snapshooter_version }}"
  addr: "{{ hostvars[inventory_hostname].ip }}:{{ genesis_registry_port }}"

keepalived_vip: ~
balance: roundrobin
inter: 2s
rise: 2
fall: 3

# kubernetes patch variables
k8s_manifest_dir: "/etc/kubernetes/manifests"
k8s_services:
  - {name: "kube-apiserver", port: 6443}
  - {name: "kube-controller-manager", port: 10257}
  - {name: "kube-scheduler", port: 10259}

# csi_rbdplugin daemonset patch variables
csi_rbdplugin_images:
  - "sig-storage/csi-node-driver-registrar:{{ csi_node_driver_registrar_version }}"
  - "cephcsi/cephcsi:{{ cephcsi_version }}"
  - "cephcsi/cephcsi:{{ cephcsi_version }}"
rbdplugins: |
  {% for v in csi_rbdplugin_images -%}
  {op: replace, "path": "/spec/template/spec/containers/{{ loop.index0 }}/image", value: "{{ containerd_insecure_registries.genesis_registry }}/{{ v }}"}
  {% endfor -%}
rbdplugin_patch_list: "{{ rbdplugins.splitlines()|map('from_yaml')|list }}"

# csi_rbdplugin_provisioner deployment patch variables
csi_rbdplugin_provisioner_images:
  - "sig-storage/csi-provisioner:{{ csi_provisioner_version }}"
  - "sig-storage/csi-snapshotter:{{ csi_snapshooter_version }}"
  - "sig-storage/csi-attacher:{{ csi_attacher_version }}"
  - "sig-storage/csi-resizer:{{ csi_resizer_version }}"
  - "cephcsi/cephcsi:{{ cephcsi_version }}"
  - "cephcsi/cephcsi:{{ cephcsi_version }}"
  - "cephcsi/cephcsi:{{ cephcsi_version }}"
provisioner: |
  {% for v in csi_rbdplugin_provisioner_images -%}
  {op: replace, path: "/spec/template/spec/containers/{{ loop.index0 }}/image", value: "{{ containerd_insecure_registries.genesis_registry }}/{{ v }}"}
  {% endfor -%}
provisioner_patch_list: "{{ provisioner.splitlines()|map('from_yaml')|list }}"
...
